<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CyberNexus | All-in-One Cyber Tool</title>
    <!-- Use Tailwind CSS for a professional and responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a new, dark color palette inspired by material.security */
        :root {
            --bg: #000000;
            --card: rgba(1, 1, 1, 0.4);
            --border: rgba(255, 255, 255, 0.08);
            --text-primary: #e5e7eb; /* Gray-200 */
            --text-secondary: #9ca3af; /* Gray-400 */
            --gradient-start: #a5b4fc; /* Indigo-300 */
            --gradient-end: #8b5cf6; /* Violet-500 */
            --highlight: #4ade80; /* Green-400 */
            --danger: #ef4444; /* Red-500 */
            --radius: 12px;
            font-family: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        
        body {
            background-color: var(--bg);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 2.5rem 1rem;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1280px;
        }

        .card {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 10px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: all 0.2s ease-in-out;
        }

        .card:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15), 0 20px 30px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: #fff;
            font-weight: 600;
            border-radius: 9999px; /* rounded-full */
            padding: 0.75rem 1.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-ghost {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-weight: 600;
            border-radius: 9999px; /* rounded-full */
            padding: 0.75rem 1.5rem;
            transition: all 0.2s ease;
        }
        
        .btn-ghost:hover {
            border-color: var(--highlight);
            color: var(--text-primary);
        }

        .text-gradient {
            background-image: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Loading spinner animation */
        .loading-spinner {
            border-top-color: var(--gradient-end);
            border-left-color: var(--gradient-end);
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal for login/alerts */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .modal-content {
            background: var(--card);
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 400px;
            width: 90%;
            border: 1px solid var(--border);
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-200">
    <div class="container mx-auto space-y-12 md:space-y-16">

        <!-- Header -->
        <header class="flex justify-between items-center py-4">
            <a class="flex items-center gap-4 text-white no-underline" href="#">
                <div class="w-12 h-12 rounded-lg flex items-center justify-center font-bold text-xl bg-gradient-to-r from-indigo-500 to-violet-500 shadow-lg">CN</div>
                <div>
                    <div class="font-extrabold text-xl">CyberNexus</div>
                    <div class="text-xs text-gray-400">All-in-One Cyber Tool</div>
                </div>
            </a>
            <nav class="hidden md:flex items-center gap-6 text-sm">
                <a class="text-gray-400 hover:text-white transition-colors" href="#checkup-info">What is Cyber Hygiene?</a>
                <a class="text-gray-400 hover:text-white transition-colors" href="#checkup">Checkup</a>
                <a class="text-gray-400 hover:text-white transition-colors" href="#cryptovault-info">What is CryptoVault?</a>
                <a class="text-gray-400 hover:text-white transition-colors" href="#cryptovault">CryptoVault</a>
                <a class="text-gray-400 hover:text-white transition-colors" href="#about-me">About Me</a>
                <button class="btn-ghost" onclick="showModal('Login is not configured for this version.')">Log In</button>
            </nav>
            <!-- Mobile nav toggle for future use -->
        </header>

        <!-- Hero Section -->
        <section class="card p-8 md:p-12 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4">
                <span class="text-gradient">Your Personal Cyber Security Toolkit</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-400 max-w-3xl mx-auto">
                A complete suite for personal and professional cyber hygiene, including a security checkup and a secure file encryption tool.
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                <button class="btn-primary" onclick="document.getElementById('checkup').scrollIntoView({behavior:'smooth'})">Start Checkup</button>
                <button class="btn-ghost" onclick="document.getElementById('cryptovault').scrollIntoView({behavior:'smooth'})">Secure a File</button>
            </div>
        </section>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
            <!-- What is Cyber Hygiene? -->
            <section id="checkup-info" class="card p-6 md:p-8 col-span-1 lg:col-span-2">
                <h2 class="text-3xl font-bold mb-4">What is Cyber Hygiene?</h2>
                <div class="grid md:grid-cols-2 gap-8 text-gray-400">
                    <p>Cyber hygiene refers to the practices and steps that users of computers and other devices take to maintain system health and improve online security. Just like personal hygiene helps prevent sickness, cyber hygiene helps prevent data breaches, malware infections, and identity theft.</p>
                    <p>This checkup is designed to help you identify and correct common security weaknesses, from weak passwords to poor data backup habits. Regularly performing a cyber hygiene checkup is crucial because the digital world is constantly changing, and staying on top of your security is the best way to protect your personal and professional life.</p>
                </div>
            </section>

            <!-- Cyber Hygiene Checkup Section -->
            <section id="checkup" class="card p-6 md:p-8 col-span-1 lg:col-span-2">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <h2 class="text-3xl font-bold mb-2">Cyber Hygiene Checkup</h2>
                        <p class="text-gray-400 mb-6">A quick checklist with instant scoring and tailored recommendations for your cyber security posture.</p>

                        <div class="space-y-4">
                            <h3 class="font-bold text-lg text-gray-200">Client Info</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <input id="name" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" type="text" placeholder="Client Name">
                                <input id="email" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" type="email" placeholder="client@email.com">
                                <input id="date" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" type="date">
                                <input id="business" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" type="text" placeholder="Organization Name">
                            </div>

                            <div class="mt-6 space-y-4">
                                <h3 class="font-bold text-lg text-gray-200">Devices & Software</h3>
                                <div id="questions" class="space-y-4"></div>
                            </div>

                            <div class="mt-6 space-y-4">
                                <h3 class="font-bold text-lg text-gray-200">Additional Notes</h3>
                                <textarea id="notes" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="4" placeholder="Any concerns, incidents, or extra details..."></textarea>
                            </div>
                        </div>

                        <div class="flex gap-4 mt-6">
                            <button class="btn-primary" onclick="calculateScore()">Submit & Score</button>
                            <button class="btn-ghost" onclick="resetForm()">Reset</button>
                        </div>
                    </div>
                    
                    <aside class="lg:col-span-1 flex flex-col justify-between">
                        <div class="card p-6 flex-1 flex flex-col items-center justify-center text-center">
                            <div class="w-32 h-32 rounded-full flex items-center justify-center text-3xl font-extrabold mb-4 border-2 border-gray-700" id="scoreBox">
                                — / 22
                            </div>
                            <div class="text-gray-400 mb-2">Overall Security</div>
                            <span class="px-4 py-1 text-sm font-bold rounded-full text-white" id="scoreBadge" style="background-color: #555;">—</span>
                            
                            <div class="mt-8 w-full" id="recSection">
                                <h4 class="font-bold text-md text-gray-200 mb-2">Recommendations</h4>
                                <div id="recList" class="text-gray-400 text-sm text-left list-disc list-inside"></div>
                            </div>
                        </div>
                        <div class="mt-6 flex flex-col sm:flex-row gap-4">
                            <button class="btn-ghost" onclick="copyReport()">Copy Report</button>
                            <button class="btn-primary" onclick="downloadReport()">Download Report</button>
                        </div>
                    </aside>
                </div>
            </section>

            <!-- What is the CryptoVault? -->
            <section id="cryptovault-info" class="card p-6 md:p-8 col-span-1 lg:col-span-2">
                <h2 class="text-3xl font-bold mb-4">What is CryptoVault?</h2>
                <div class="grid md:grid-cols-2 gap-8 text-gray-400">
                    <div>
                        <p class="mb-4">CryptoVault is a client-side file encryption tool. This means all the encryption and decryption happens right here in your browser, on your device. Your files and passwords are never sent to a server. This ensures your data remains completely private and secure, giving you full control over your information.</p>
                        <p class="mb-4">This is a powerful way to protect sensitive documents before storing them in the cloud or sending them to others. Just remember the password you use—it's the only way to get your file back!</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-200 mb-2">How to Use</h3>
                        <ul class="list-disc list-inside space-y-2 mb-4">
                            <li>**To Encrypt:**
                                <ul class="list-disc list-inside ml-4">
                                    <li>Choose a file to encrypt.</li>
                                    <li>Enter a strong password that you will remember.</li>
                                    <li>Click the "Encrypt" button to download your new `.crypt` file.</li>
                                </ul>
                            </li>
                            <li>**To Decrypt:**
                                <ul class="list-disc list-inside ml-4">
                                    <li>Choose the encrypted `.crypt` file.</li>
                                    <li>Enter the *exact same* password you used to encrypt it.</li>
                                    <li>Click the "Decrypt" button to download the original file.</li>
                                </ul>
                            </li>
                        </ul>
                        <h3 class="text-xl font-bold text-gray-200 mb-2">What can you encrypt?</h3>
                        <p>This tool can encrypt any type of file. The file type is preserved so you can decrypt it back to its original format. This includes:</p>
                        <ul class="list-disc list-inside space-y-1 mt-2">
                            <li>Documents (.docx, .pdf, .txt, .csv)</li>
                            <li>Images (.jpg, .png, .gif)</li>
                            <li>Videos (.mp4, .mov)</li>
                            <li>Spreadsheets (.xlsx)</li>
                            <li>Code files (.js, .html, .py)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- CryptoVault Section -->
            <section id="cryptovault" class="card p-6 md:p-8 col-span-1 lg:col-span-1">
                <h2 class="text-3xl font-bold mb-2">CryptoVault</h2>
                <p class="text-gray-400 mb-6">Securely encrypt and decrypt files directly in your browser. All processing is done locally and privately.</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Encryption Card -->
                    <div class="card p-6 flex flex-col">
                        <h3 class="text-2xl font-bold mb-4">Encrypt File</h3>
                        <label for="encryptFile" class="w-full p-4 rounded-lg text-center text-gray-400 border-2 border-dashed border-gray-700 hover:border-violet-500 transition-colors cursor-pointer">
                            <span id="encryptFileName">Choose a file to encrypt</span>
                        </label>
                        <input type="file" id="encryptFile" class="hidden" />
                        
                        <input type="password" id="encryptPassword" placeholder="Enter a strong password" class="w-full p-3 mt-4 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-violet-500" autocomplete="off" />
                        
                        <button id="encryptBtn" class="btn-primary w-full mt-6">
                            Encrypt
                        </button>
                        
                        <div id="encryptStatus" class="mt-4 text-center text-sm font-medium text-gray-400"></div>
                    </div>

                    <!-- Decryption Card -->
                    <div class="card p-6 flex flex-col">
                        <h3 class="text-2xl font-bold mb-4">Decrypt File</h3>
                        <label for="decryptFile" class="w-full p-4 rounded-lg text-center text-gray-400 border-2 border-dashed border-gray-700 hover:border-violet-500 transition-colors cursor-pointer">
                            <span id="decryptFileName">Choose a file to decrypt</span>
                        </label>
                        <input type="file" id="decryptFile" class="hidden" />

                        <input type="password" id="decryptPassword" placeholder="Enter the decryption password" class="w-full p-3 mt-4 rounded-lg bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-violet-500" autocomplete="off" />
                        
                        <button id="decryptBtn" class="btn-primary w-full mt-6">
                            Decrypt
                        </button>
                        
                        <div id="decryptStatus" class="mt-4 text-center text-sm font-medium text-gray-400"></div>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- About Me Section -->
        <section id="about-me" class="card p-6 md:p-8 max-w-4xl mx-auto mt-12 relative">
            <div class="flex justify-center -mt-16 md:-mt-20 mb-6">
                <!-- NOTE: This is a placeholder image. To use your own photo, replace the src URL below with a link to your image. -->
                <img src="https://placehold.co/128x128/6B46C1/FFFFFF?text=LK" alt="Lalit Kudmethe" class="w-24 h-24 md:w-32 md:h-32 rounded-full object-cover border-4 border-gray-800 shadow-xl" />
            </div>
            <h2 class="text-3xl font-bold mb-4 text-center text-gradient">About Me</h2>
            <div class="max-w-2xl mx-auto text-center space-y-4 text-gray-400">
                <p>Hello! My name is **Lalit Kudmethe**, a passionate cybersecurity enthusiast dedicated to building tools that empower and protect people in the digital world. My goal is to make a positive impact by creating accessible solutions that enhance digital safety for everyone.</p>
                <p>This CyberNexus tool is a small part of that mission, designed to help individuals and small businesses improve their online security posture and protect their data.</p>
                <p>You can connect with me and learn more about my work on my <a href="https://www.linkedin.com/in/lalit-kudmethe-189910312/" target="_blank" class="text-indigo-400 hover:text-indigo-300 transition-colors">LinkedIn profile</a>.</p>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="card p-6 md:p-8 max-w-4xl mx-auto mt-12">
            <h2 class="text-3xl font-bold mb-4 text-center">About this tool</h2>
            <p class="text-gray-400 text-center max-w-2xl mx-auto mb-8">This single-file tool is built for clients and consultants who want a clean, professional single-page app to score cyber hygiene and securely manage files. It runs entirely in the browser and stores no data remotely.</p>
        </section>

        <!-- Download link for CryptoVault (hidden until a file is ready) -->
        <a id="downloadLink" class="hidden" download></a>

    </div>

    <!-- Custom Modal for Alerts -->
    <div id="customModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <h3 id="modal-title" class="text-lg font-bold mb-2">Notice</h3>
            <p id="modal-message" class="text-gray-400 mb-4"></p>
            <button class="btn-primary w-full" onclick="hideModal()">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Cyber Checkup Functionality ---
            // Questions and corresponding recommendation messages
            const questions = [
                "Do you use a password to unlock your devices (phone, laptop, etc.)?",
                "Are all your devices (phones, laptops, tablets) regularly updated?",
                "Do you use antivirus or security software on your computer?",
                "Do you regularly back up your files (cloud or external drive)?",
                "Are your mobile apps and software downloaded only from trusted sources?",
                "Do you use strong, unique passwords for your accounts?",
                "Do you use a password manager to store and generate passwords?",
                "Do you reuse the same password for multiple accounts?",
                "Is two-factor authentication (2FA) enabled on your main accounts?",
                "Have you ever checked if your passwords or email were leaked online?",
                "Do you recognize and avoid suspicious or phishing emails?",
                "Do you avoid clicking unknown links or attachments in emails or texts?",
                "Are your spam/junk filters turned on and working?",
                "Do you know how to report phishing emails in your email service?",
                "Are your social media accounts set to private or friends only?",
                "Do you limit the personal info you share online (location, contact info)?",
                "Do you regularly review app permissions on Facebook, Google, etc.?",
                "Are your browser privacy settings adjusted for more security?",
                "Do you control who has access to sensitive data or client info?",
                "Do you use business-grade tools (email, file storage, etc.)?",
                "Are employees/team members trained in cybersecurity basics?",
                "Is your website secure (HTTPS enabled)?"
            ];
            const recs = [
                "Enable password protection on devices",
                "Turn on automatic updates for OS and apps",
                "Install reputable antivirus or endpoint protection",
                "Set up automated cloud backups and offline backups",
                "Download apps only from official stores",
                "Use strong, unique passwords for each account",
                "Use a reputable password manager (Bitwarden, 1Password)",
                "Stop reusing passwords — update reused passwords now",
                "Enable two-factor authentication (2FA) on major accounts",
                "Check for leaks on haveibeenpwned.com and rotate breached passwords",
                "Take a phishing awareness quick training",
                "Avoid clicking unknown links or attachments",
                "Ensure spam filters are enabled and tuned",
                "Learn how to report phishing in your email provider",
                "Set social profiles to private and limit public info",
                "Limit personal data shared online (DOB, address, phone)",
                "Review and revoke unnecessary app permissions",
                "Use stricter browser privacy settings and extensions",
                "Implement access controls and least privilege",
                "Switch to business-grade productivity and storage tools",
                "Run regular cybersecurity training for staff",
                "Install SSL/TLS so your site uses HTTPS"
            ];

            // Render questions to DOM with Yes/No radios
            const qContainer = document.getElementById('questions');
            questions.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = 'flex flex-col md:flex-row md:items-center justify-between p-4 bg-gray-900 rounded-lg';
                div.innerHTML = `
                    <label class="text-sm font-medium text-gray-200 mb-2 md:mb-0">${q}</label>
                    <div class="flex gap-4">
                        <label class="text-sm text-gray-400"><input type="radio" name="q${i}" value="Yes" class="mr-1"> Yes</label>
                        <label class="text-sm text-gray-400"><input type="radio" name="q${i}" value="No" class="mr-1"> No</label>
                    </div>
                `;
                qContainer.appendChild(div);
            });

            // Scoring and recommendation logic
            function calculateScore(){
                const answers = [];
                for(let i=0;i<questions.length;i++){
                    const sel = document.querySelector(`input[name="q${i}"]:checked`);
                    answers.push(sel ? sel.value : 'Unanswered');
                }

                // Score: Yes=1 except for reused-passwords (question index 7) where Yes is bad
                let score = 0;
                for(let i=0;i<answers.length;i++){
                    if(i===7){ // reused passwords
                        if(answers[i] === 'No') score += 1;
                    } else {
                        if(answers[i] === 'Yes') score += 1;
                    }
                }
                const max = questions.length;
                const pct = Math.round((score/max)*100);

                // Build recommendations from negative answers
                const recList = [];
                for(let i=0;i<answers.length;i++){
                    if(i===7 && answers[i] === 'Yes') recList.push(recs[i]);
                    else if(i!==7 && answers[i] === 'No') recList.push(recs[i]);
                    else if(answers[i] === 'Unanswered') recList.push('Question "'+questions[i]+'" is unanswered.');
                }

                // Populate UI
                document.getElementById('scoreBox').textContent = `${score} / ${max}`;
                const badge = document.getElementById('scoreBadge');
                if(pct >= 80){ badge.textContent = 'Good'; badge.style.backgroundColor = 'var(--highlight)'; }
                else if(pct >= 50){ badge.textContent = 'Fair'; badge.style.backgroundColor = '#f59e0b'; }
                else { badge.textContent = 'At Risk'; badge.style.backgroundColor = 'var(--danger)'; }
                
                const scoreBox = document.getElementById('scoreBox');
                scoreBox.style.color = 'var(--text-primary)';
                if(pct >= 80){ scoreBox.style.borderColor = 'var(--highlight)'; scoreBox.style.color = 'var(--highlight)'; }
                else if(pct >=50){ scoreBox.style.borderColor = '#f59e0b'; scoreBox.style.color = '#f59e0b'; }
                else { scoreBox.style.borderColor = 'var(--danger)'; scoreBox.style.color = 'var(--danger)'; }


                // Recommendations UI
                const recDiv = document.getElementById('recList');
                if(recList.length===0){ recDiv.innerHTML = '<li class="text-gray-400 list-none">No immediate actions — well done.</li>'; }
                else {
                    recDiv.innerHTML = '<ul>' + recList.map(r=>'<li class="mb-2">'+escapeHtml(r)+'</li>').join('') + '</ul>';
                }

                // store latest for export/copy
                window.latestReport = {
                    meta: {
                        name: document.getElementById('name').value || '',
                        email: document.getElementById('email').value || '',
                        date: document.getElementById('date').value || new Date().toISOString().slice(0,10),
                        business: document.getElementById('business').value || ''
                    },
                    score: score,
                    max: max,
                    percent: pct,
                    recommendations: recList,
                    notes: document.getElementById('notes').value || ''
                };
            }

            // helpers
            function escapeHtml(str){
                if(!str) return '';
                return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
            }

            function resetForm(){
                document.getElementById('name').value='';
                document.getElementById('email').value='';
                document.getElementById('date').value='';
                document.getElementById('business').value='';
                document.getElementById('notes').value='';
                for(let i=0;i<questions.length;i++){
                    const r = document.querySelectorAll(`input[name="q${i}"]`);
                    r.forEach(x=>x.checked=false);
                }
                document.getElementById('scoreBox').textContent = '— / 22';
                document.getElementById('scoreBox').style.borderColor = 'var(--gray-700)';
                document.getElementById('scoreBox').style.color = 'var(--text-primary)';
                document.getElementById('scoreBadge').textContent = '—';
                document.getElementById('scoreBadge').style.backgroundColor = '#555';
                document.getElementById('recList').innerHTML='';
                window.latestReport = null;
            }

            // report copy/download
            function copyReport(){
                if(!window.latestReport){ 
                    showModal("Please submit the checkup form first to generate a report.");
                    return; 
                }
                const rpt = buildPlainReport(window.latestReport);
                navigator.clipboard.writeText(rpt).then(()=>{
                    showModal('Report copied to clipboard. You can now paste it into an email or document.');
                }, ()=>{ showModal('Unable to copy report. Please try again.'); });
            }

            function downloadReport(){
                if(!window.latestReport){ 
                    showModal("Please submit the checkup form first to generate a report.");
                    return; 
                }
                const rpt = buildPlainReport(window.latestReport);
                const blob = new Blob([rpt], {type:'text/plain;charset=utf-8'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = (window.latestReport.meta.name || 'checkup') + '_cyber_report.txt';
                document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
            }

            function buildPlainReport(r){
                if(!r) return '';
                return `Cyber Hygiene Checkup Report
Name: ${r.meta.name}
Email: ${r.meta.email}
Business: ${r.meta.business}
Date: ${r.meta.date}

Score: ${r.score} / ${r.max} (${r.percent}%)

Recommendations:
- ${r.recommendations.join('\n- ')}

Notes:
${r.notes}

Generated with CyberNexus Checkup`;
            }
            
            // UX: live update score as radios change
            document.addEventListener('change', (e)=>{
                if(e.target && e.target.name && e.target.name.startsWith('q')){
                    clearTimeout(window.__liveDeb);
                    window.__liveDeb = setTimeout(()=>{ calculateScore(); }, 300);
                }
            });

            // --- CryptoVault Functionality ---
            // UI Elements
            const encryptFile = document.getElementById('encryptFile');
            const decryptFile = document.getElementById('decryptFile');
            const encryptFileNameSpan = document.getElementById('encryptFileName');
            const decryptFileNameSpan = document.getElementById('decryptFileName');
            const encryptPassword = document.getElementById('encryptPassword');
            const decryptPassword = document.getElementById('decryptPassword');
            const encryptBtn = document.getElementById('encryptBtn');
            const decryptBtn = document.getElementById('decryptBtn');
            const encryptStatus = document.getElementById('encryptStatus');
            const decryptStatus = document.getElementById('decryptStatus');
            const downloadLink = document.getElementById('downloadLink');

            // Constants for Cryptography
            const ALGORITHM = 'AES-GCM';
            const PBKDF2_ITERATIONS = 100000;
            const KEY_SIZE = 256; // 256-bit key
            const SALT_LENGTH = 16;
            const IV_LENGTH = 12; // 12-byte IV is standard for AES-GCM

            // Helper function to update the button status (loading, text)
            function updateButtonStatus(button, statusElement, text, isLoading = false, isError = false) {
                button.disabled = isLoading;
                statusElement.innerHTML = isLoading ? `
                    <div class="loading-spinner w-5 h-5 border-4 border-gray-500 rounded-full mx-auto"></div>
                ` : text;
                if (isError) {
                    statusElement.classList.remove('text-gray-400');
                    statusElement.classList.add('text-red-500');
                } else {
                    statusElement.classList.remove('text-red-500');
                    statusElement.classList.add('text-gray-400');
                }
            }

            // Helper function to create a blob URL and trigger a download
            function triggerDownload(blob, fileName, statusElement, linkElement) {
                const url = URL.createObjectURL(blob);
                
                linkElement.href = url;
                linkElement.download = fileName;
                linkElement.click();

                setTimeout(() => {
                    URL.revokeObjectURL(url);
                }, 500);

                statusElement.textContent = `Download of "${fileName}" started automatically.`;
            }

            // Encryption Functionality
            encryptFile.addEventListener('change', (e) => {
                encryptFileNameSpan.textContent = e.target.files[0]?.name || 'Choose a file to encrypt';
                encryptStatus.innerHTML = '';
            });

            encryptBtn.addEventListener('click', async () => {
                const file = encryptFile.files[0];
                const password = encryptPassword.value;

                if (!file || !password) {
                    return updateButtonStatus(encryptBtn, encryptStatus, 'Please select a file and enter a password.', false, true);
                }

                updateButtonStatus(encryptBtn, encryptStatus, '', true);

                try {
                    const fileData = await file.arrayBuffer();
                    const salt = window.crypto.getRandomValues(new Uint8Array(SALT_LENGTH));
                    const iv = window.crypto.getRandomValues(new Uint8Array(IV_LENGTH));
                    const passwordBuffer = new TextEncoder().encode(password);
                    const keyMaterial = await window.crypto.subtle.importKey(
                        'raw',
                        passwordBuffer,
                        { name: 'PBKDF2' },
                        false,
                        ['deriveKey']
                    );
                    const key = await window.crypto.subtle.deriveKey(
                        { name: 'PBKDF2', salt: salt, iterations: PBKDF2_ITERATIONS, hash: 'SHA-256' },
                        keyMaterial,
                        { name: ALGORITHM, length: KEY_SIZE },
                        true,
                        ['encrypt']
                    );
                    const encryptedData = await window.crypto.subtle.encrypt(
                        { name: ALGORITHM, iv: iv },
                        key,
                        fileData
                    );
                    const metadata = { name: file.name, type: file.type };
                    const metadataBuffer = new TextEncoder().encode(JSON.stringify(metadata));
                    const metadataLengthBuffer = new Uint8Array(4);
                    new DataView(metadataLengthBuffer.buffer).setUint32(0, metadataBuffer.byteLength, false);

                    const combinedData = new Blob([salt, iv, metadataLengthBuffer, metadataBuffer, new Uint8Array(encryptedData)]);
                    triggerDownload(combinedData, file.name + '.crypt', encryptStatus, downloadLink);
                    updateButtonStatus(encryptBtn, encryptStatus, '', false);

                } catch (error) {
                    console.error('Encryption failed:', error);
                    updateButtonStatus(encryptBtn, encryptStatus, 'Encryption failed. Please check your password and file.', false, true);
                }
            });

            // Decryption Functionality
            decryptFile.addEventListener('change', (e) => {
                decryptFileNameSpan.textContent = e.target.files[0]?.name || 'Choose a file to decrypt';
                decryptStatus.innerHTML = '';
            });

            decryptBtn.addEventListener('click', async () => {
                const file = decryptFile.files[0];
                const password = decryptPassword.value;

                if (!file || !password) {
                    return updateButtonStatus(decryptBtn, decryptStatus, 'Please select a file and enter a password.', false, true);
                }

                updateButtonStatus(decryptBtn, decryptStatus, '', true);

                try {
                    const encryptedBuffer = await file.arrayBuffer();
                    const salt = new Uint8Array(encryptedBuffer.slice(0, SALT_LENGTH));
                    const iv = new Uint8Array(encryptedBuffer.slice(SALT_LENGTH, SALT_LENGTH + IV_LENGTH));
                    const metadataLengthView = new DataView(encryptedBuffer.slice(SALT_LENGTH + IV_LENGTH, SALT_LENGTH + IV_LENGTH + 4));
                    const metadataLength = metadataLengthView.getUint32(0, false);
                    const metadataBuffer = encryptedBuffer.slice(SALT_LENGTH + IV_LENGTH + 4, SALT_LENGTH + IV_LENGTH + 4 + metadataLength);
                    const encryptedDataBuffer = encryptedBuffer.slice(SALT_LENGTH + IV_LENGTH + 4 + metadataLength);
                    const metadata = JSON.parse(new TextDecoder().decode(metadataBuffer));
                    const passwordBuffer = new TextEncoder().encode(password);
                    const keyMaterial = await window.crypto.subtle.importKey(
                        'raw',
                        passwordBuffer,
                        { name: 'PBKDF2' },
                        false,
                        ['deriveKey']
                    );
                    const key = await window.crypto.subtle.deriveKey(
                        { name: 'PBKDF2', salt: salt, iterations: PBKDF2_ITERATIONS, hash: 'SHA-256' },
                        keyMaterial,
                        { name: ALGORITHM, length: KEY_SIZE },
                        true,
                        ['decrypt']
                    );
                    const decryptedData = await window.crypto.subtle.decrypt(
                        { name: ALGORITHM, iv: iv },
                        key,
                        encryptedDataBuffer
                    );
                    const decryptedBlob = new Blob([decryptedData], { type: metadata.type });
                    triggerDownload(decryptedBlob, metadata.name, decryptStatus, downloadLink);
                    updateButtonStatus(decryptBtn, decryptStatus, '', false);

                } catch (error) {
                    console.error('Decryption failed:', error);
                    updateButtonStatus(decryptBtn, decryptStatus, 'Decryption failed. Please check the password or file.', false, true);
                }
            });


            // --- Modal Functions ---
            const modal = document.getElementById('customModal');
            const modalMessage = document.getElementById('modal-message');

            function showModal(message) {
                modalMessage.textContent = message;
                modal.classList.remove('hidden');
            }

            function hideModal() {
                modal.classList.add('hidden');
            }
            window.showModal = showModal;
            window.hideModal = hideModal;
        });
    </script>
</body>
</html>
